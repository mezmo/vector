use crate::mezmo::{choose, choose_weighted};
use chrono::format::{DelayedFormat, StrftimeItems};
use chrono::{Local, SecondsFormat};
use faker_rand::en_us::internet::{Domain, Username};
use lazy_static::lazy_static;
use rand::{distributions::Uniform, prelude::*, thread_rng};

const SYSLOG_3164_FORMAT: &str = "%b %d %T";
const APPLICATION_NAMES: [(&str, f32); 5] = [
    ("sshd", 6.0),
    ("klogind", 3.1),
    ("su", 0.5),
    ("cups", 0.2),
    ("logrotate", 0.2),
];

const SSHD_MESSAGES: [(&str, f32); 9] = [
    ("check pass; user unknown. ... CONTEXT: { AuthMethodAttempted: 'password', AttemptedUser: 'testuser123', ProtocolVersion: 'SSH-2.0-OpenSSH_8.2p1', ClientVersionRaw: 'SSH-2.0-Go', SourceIP: '198.51.100.55', SourcePort: 51234, DestPort: 22, KexAlgorithms: ['curve25519-sha256'], ServerHostKeyAlgorithms: ['ssh-ed25519'], Ciphers: ['chacha20-poly1305@openssh.com'], MACs: ['hmac-sha2-512-etm@openssh.com'], PamService: 'sshd', PamUser: 'testuser123', PamRhost: '198.51.100.55', PamTty: 'ssh', PamStatus: 'User not known to the underlying authentication module', PamModule: 'pam_unix.so', Fail2BanStatus: { Filter: 'sshd', Jail: 'sshd', Attempts: 1, MaxAttempts: 5, BanTime: 600, LastAttemptTime: 1678896661 }, SystemLoad: { Avg1m: 0.2, Avg5m: 0.3, Avg15m: 0.3 }, MemoryUsage: { TotalMB: 8192, UsedMB: 2048, FreeMB: 6144 }, ActiveSessions: 2, FailedLoginAttemptsSinceLastSuccess: 0, FirewallRuleHit: 'None', GeoIP: { Country: 'Canada', City: 'Toronto', ISP: 'Example ISP Inc.' } } ... [Simulated Detail Repeated For Length] UserLookup{user='testuser123', result=NOT_FOUND, source=passwd} UserLookup{user='testuser123', result=NOT_FOUND, source=ldap} UserLookup{user='testuser123', result=NOT_FOUND, source=sss} UserLookup{user='testuser123', result=NOT_FOUND, source=passwd} UserLookup{user='testuser123', result=NOT_FOUND, source=ldap} UserLookup{user='testuser123', result=NOT_FOUND, source=sss} UserLookup{user='testuser123', result=NOT_FOUND, source=passwd} UserLookup{user='testuser123', result=NOT_FOUND, source=ldap} UserLookup{user='testuser123', result=NOT_FOUND, source=sss} UserLookup{user='testuser123', result=NOT_FOUND, source=passwd} UserLookup{user='testuser123', result=NOT_FOUND, source=ldap} UserLookup{user='testuser123', result=NOT_FOUND, source=sss} UserLookup{user='testuser123', result=NOT_FOUND, source=passwd} UserLookup{user='testuser123', result=NOT_FOUND, source=ldap} UserLookup{user='testuser123', result=NOT_FOUND, source=sss} UserLookup{user='testuser123', result=NOT_FOUND, source=passwd} UserLookup{user='testuser123', result=NOT_FOUND, source=ldap} UserLookup{user='testuser123', result=NOT_FOUND, source=sss} UserLookup{user='testuser123', result=NOT_FOUND, source=passwd} UserLookup{user='testuser123', result=NOT_FOUND, source=ldap} UserLookup{user='testuser123', result=NOT_FOUND, source=sss} UserLookup{user='testuser123', result=NOT_FOUND, source=passwd} UserLookup{user='testuser123', result=NOT_FOUND, source=ldap} UserLookup{user='testuser123', result=NOT_FOUND, source=sss} UserLookup{user='testuser123', result=NOT_FOUND, source=passwd} UserLookup{user='testuser123', result=NOT_FOUND, source=ldap} UserLookup{user='testuser123', result=NOT_FOUND, source=sss} UserLookup{user='testuser123', result=NOT_FOUND, source=passwd} UserLookup{user='testuser123', result=NOT_FOUND, source=ldap} UserLookup{user='testuser123', result=NOT_FOUND, source=sss} UserLookup{user='testuser123', result=NOT_FOUND, source=passwd} UserLookup{user='testuser123', result=NOT_FOUND, source=ldap} UserLookup{user='testuser123', result=NOT_FOUND, source=sss} UserLookup{user='testuser123', result=NOT_FOUND, source=passwd} UserLookup{user='testuser123', result=NOT_FOUND, source=ldap} UserLookup{user='testuser123', result=NOT_FOUND, source=sss} UserLookup{user='testuser123', result=NOT_FOUND, source=passwd} UserLookup{user='testuser123', result=NOT_FOUND, source=ldap} UserLookup{user='testuser123', result=NOT_FOUND, source=sss} END_CONTEXT", 2.0),
    ("authentication failure; logname= uid=0 euid=0 tty=NODEVssh ruser= rhost=troi.bluesky-technologies.com user=root. ... CONTEXT: { AuthMethodAttempted: 'password', AttemptedUser: 'root', ProtocolVersion: 'SSH-2.0-OpenSSH_7.9p1 Debian-10+deb10u2', ClientVersionRaw: 'SSH-2.0-libssh-0.9.3', KexAlgorithms: ['curve25519-sha256@libssh.org'], ServerHostKeyAlgorithms: ['ecdsa-sha2-nistp256'], EncryptionAlgorithmsClientToServer: ['aes128-gcm@openssh.com'], MacAlgorithmsClientToServer: ['hmac-sha2-256'], CompressionAlgorithmsClientToServer: ['none'], PamService: 'sshd', PamUser: 'root', PamRhost: 'troi.bluesky-technologies.com', PamTty: 'ssh', PamStatus: 'Authentication failure', PamModule: 'pam_unix.so', PamMessage: 'Incorrect password', Fail2BanStatus: { Filter: 'sshd', Jail: 'sshd', Attempts: 4, MaxAttempts: 5, BanTime: 600, LastAttemptTime: 1678896662 }, SystemLoad: { Avg1m: 0.6, Avg5m: 0.45, Avg15m: 0.38 }, MemoryUsage: { TotalMB: 16384, UsedMB: 4096, FreeMB: 12288 }, ActiveSessions: 8, FailedLoginAttemptsSinceLastSuccess: 4, FirewallRuleHit: 'None', GeoIP: { Country: 'USA', City: 'Los Angeles', ISP: 'BlueSky Technologies LLC' } } ... [Simulated Detail Repeated For Length] AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} AuthFailure{rhost='troi.bluesky-technologies.com', user='root', method='password', count=4} END_CONTEXT", 1.0),
    ("Accepted publickey for alice from 192.168.10.100 port 54321 ssh2: RSA SHA256:zzzyyyxxxwwvvvuuutttsssrrrqqqppponmlkjihgfedcba. ... CONTEXT: { User: 'alice', SourceIP: '192.168.10.100', SourcePort: 54321, AuthMethod: 'publickey', KeyType: 'ssh-rsa', KeyFingerprint: 'SHA256:zzzyyyxxxwwvvvuuutttsssrrrqqqppponmlkjihgfedcba', AcceptedKeySource: '/home/alice/.ssh/authorized_keys:1', SessionID: 'session-abc-123', TTY: 'pts/0', Protocol: 'SSH-2.0-OpenSSH_8.8', ClientVersion: 'SSH-2.0-OpenSSH_8.8', KexAlgorithm: 'curve25519-sha256', Cipher: 'aes256-gcm@openssh.com', MAC: 'hmac-sha2-512-etm@openssh.com', PamService: 'sshd', PamUser: 'alice', PamStatus: 'Success', LoginTime: 1678896663, UserGroups: ['alice', 'developers', 'docker'], HomeDirectory: '/home/alice', Shell: '/bin/bash' } ... [Simulated Detail Repeated For Length] EnvVar{name='SSH_CLIENT', value='192.168.10.100 54321 22'} EnvVar{name='SSH_CONNECTION', value='192.168.10.100 54321 192.168.10.5 22'} EnvVar{name='SSH_TTY', value='/dev/pts/0'} EnvVar{name='USER', value='alice'} EnvVar{name='HOME', value='/home/alice'} EnvVar{name='SHELL', value='/bin/bash'} EnvVar{name='LANG', value='en_US.UTF-8'} EnvVar{name='PATH', value='/usr/local/bin:/usr/bin:/bin'} EnvVar{name='SSH_CLIENT', value='192.168.10.100 54321 22'} EnvVar{name='SSH_CONNECTION', value='192.168.10.100 54321 192.168.10.5 22'} EnvVar{name='SSH_TTY', value='/dev/pts/0'} EnvVar{name='USER', value='alice'} EnvVar{name='HOME', value='/home/alice'} EnvVar{name='SHELL', value='/bin/bash'} EnvVar{name='LANG', value='en_US.UTF-8'} EnvVar{name='PATH', value='/usr/local/bin:/usr/bin:/bin'} EnvVar{name='SSH_CLIENT', value='192.168.10.100 54321 22'} EnvVar{name='SSH_CONNECTION', value='192.168.10.100 54321 192.168.10.5 22'} EnvVar{name='SSH_TTY', value='/dev/pts/0'} EnvVar{name='USER', value='alice'} EnvVar{name='HOME', value='/home/alice'} EnvVar{name='SHELL', value='/bin/bash'} EnvVar{name='LANG', value='en_US.UTF-8'} EnvVar{name='PATH', value='/usr/local/bin:/usr/bin:/bin'} EnvVar{name='SSH_CLIENT', value='192.168.10.100 54321 22'} EnvVar{name='SSH_CONNECTION', value='192.168.10.100 54321 192.168.10.5 22'} EnvVar{name='SSH_TTY', value='/dev/pts/0'} EnvVar{name='USER', value='alice'} EnvVar{name='HOME', value='/home/alice'} EnvVar{name='SHELL', value='/bin/bash'} EnvVar{name='LANG', value='en_US.UTF-8'} EnvVar{name='PATH', value='/usr/local/bin:/usr/bin:/bin'} EnvVar{name='SSH_CLIENT', value='192.168.10.100 54321 22'} EnvVar{name='SSH_CONNECTION', value='192.168.10.100 54321 192.168.10.5 22'} EnvVar{name='SSH_TTY', value='/dev/pts/0'} EnvVar{name='USER', value='alice'} EnvVar{name='HOME', value='/home/alice'} EnvVar{name='SHELL', value='/bin/bash'} EnvVar{name='LANG', value='en_US.UTF-8'} EnvVar{name='PATH', value='/usr/local/bin:/usr/bin:/bin'} EnvVar{name='SSH_CLIENT', value='192.168.10.100 54321 22'} EnvVar{name='SSH_CONNECTION', value='192.168.10.100 54321 192.168.10.5 22'} EnvVar{name='SSH_TTY', value='/dev/pts/0'} EnvVar{name='USER', value='alice'} EnvVar{name='HOME', value='/home/alice'} EnvVar{name='SHELL', value='/bin/bash'} EnvVar{name='LANG', value='en_US.UTF-8'} EnvVar{name='PATH', value='/usr/local/bin:/usr/bin:/bin'} EnvVar{name='SSH_CLIENT', value='192.168.10.100 54321 22'} EnvVar{name='SSH_CONNECTION', value='192.168.10.100 54321 192.168.10.5 22'} EnvVar{name='SSH_TTY', value='/dev/pts/0'} EnvVar{name='USER', value='alice'} EnvVar{name='HOME', value='/home/alice'} END_CONTEXT", 1.0),
    ("pam_unix(sshd:session): session opened for user bob by (uid=0). ... CONTEXT: { PamService: 'sshd', PamModule: 'pam_unix.so', PamOperation: 'session_open', PamUser: 'bob', PamTTY: 'ssh', PamRhost: 'client- workstation.example.com', PamStatus: 'Success', SessionID: 'session-def-456', UserID: 1001, GroupID: 1001, Groups: ['bob', 'developers'], InitiatingUserUID: 0, InitiatingProcess: 'sshd (pid=12403)', Terminal: '/dev/pts/1', LoginTime: 1678896664, SystemLoad: 0.9, ActiveUserSessions: 3 } ... [Simulated Detail Repeated For Length] PamEnv{name='XDG_SESSION_ID', value='c2'} PamEnv{name='USER', value='bob'} PamEnv{name='HOME', value='/home/bob'} PamEnv{name='SHELL', value='/bin/zsh'} PamEnv{name='MAIL', value='/var/mail/bob'} PamEnv{name='LOGNAME', value='bob'} PamEnv{name='PATH', value='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'} PamEnv{name='LANG', value='C.UTF-8'} PamEnv{name='XDG_SESSION_ID', value='c2'} PamEnv{name='USER', value='bob'} PamEnv{name='HOME', value='/home/bob'} PamEnv{name='SHELL', value='/bin/zsh'} PamEnv{name='MAIL', value='/var/mail/bob'} PamEnv{name='LOGNAME', value='bob'} PamEnv{name='PATH', value='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'} PamEnv{name='LANG', value='C.UTF-8'} PamEnv{name='XDG_SESSION_ID', value='c2'} PamEnv{name='USER', value='bob'} PamEnv{name='HOME', value='/home/bob'} PamEnv{name='SHELL', value='/bin/zsh'} PamEnv{name='MAIL', value='/var/mail/bob'} PamEnv{name='LOGNAME', value='bob'} PamEnv{name='PATH', value='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'} PamEnv{name='LANG', value='C.UTF-8'} PamEnv{name='XDG_SESSION_ID', value='c2'} PamEnv{name='USER', value='bob'} PamEnv{name='HOME', value='/home/bob'} PamEnv{name='SHELL', value='/bin/zsh'} PamEnv{name='MAIL', value='/var/mail/bob'} PamEnv{name='LOGNAME', value='bob'} PamEnv{name='PATH', value='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'} PamEnv{name='LANG', value='C.UTF-8'} PamEnv{name='XDG_SESSION_ID', value='c2'} PamEnv{name='USER', value='bob'} PamEnv{name='HOME', value='/home/bob'} PamEnv{name='SHELL', value='/bin/zsh'} PamEnv{name='MAIL', value='/var/mail/bob'} PamEnv{name='LOGNAME', value='bob'} PamEnv{name='PATH', value='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'} PamEnv{name='LANG', value='C.UTF-8'} PamEnv{name='XDG_SESSION_ID', value='c2'} PamEnv{name='USER', value='bob'} PamEnv{name='HOME', value='/home/bob'} PamEnv{name='SHELL', value='/bin/zsh'} PamEnv{name='MAIL', value='/var/mail/bob'} PamEnv{name='LOGNAME', value='bob'} PamEnv{name='PATH', value='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'} PamEnv{name='LANG', value='C.UTF-8'} PamEnv{name='XDG_SESSION_ID', value='c2'} PamEnv{name='USER', value='bob'} PamEnv{name='HOME', value='/home/bob'} PamEnv{name='SHELL', value='/bin/zsh'} PamEnv{name='MAIL', value='/var/mail/bob'} PamEnv{name='LOGNAME', value='bob'} PamEnv{name='PATH', value='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'} PamEnv{name='LANG', value='C.UTF-8'} PamEnv{name='XDG_SESSION_ID', value='c2'} PamEnv{name='USER', value='bob'} PamEnv{name='HOME', value='/home/bob'} PamEnv{name='SHELL', value='/bin/zsh'} PamEnv{name='MAIL', value='/var/mail/bob'} PamEnv{name='LOGNAME', value='bob'} PamEnv{name='PATH', value='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'} PamEnv{name='LANG', value='C.UTF-8'} END_CONTEXT", 1.0),
    ("pam_unix(sshd:session): session closed for user bob. ... CONTEXT: { PamService: 'sshd', PamModule: 'pam_unix.so', PamOperation: 'session_close', PamUser: 'bob', PamTTY: 'ssh', PamRhost: 'client-workstation.example.com', PamStatus: 'Success', SessionID: 'session-def-456', UserID: 1001, GroupID: 1001, SessionStartTime: 1678896664, SessionEndTime: 1678896665, SessionDurationSec: 1, BytesTransferredIn: 10240, BytesTransferredOut: 51200, Terminal: '/dev/pts/1', ClosingProcess: 'sshd (pid=12404)', SystemLoad: 0.8 } ... [Simulated Detail Repeated For Length] SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} SessionResourceUsage{cpu_time_ms=500, memory_peak_kb=150000, disk_read_bytes=100000, disk_write_bytes=50000} END_CONTEXT", 1.0),
    ("Received disconnect from 192.168.10.100 port 54321: 11: Bye Bye [preauth]. ... CONTEXT: { DisconnectReasonCode: 11, DisconnectReasonMessage: 'Bye Bye', AuthenticationPhase: 'preauth', User: '(unknown)', SourceIP: '192.168.10.100', SourcePort: 54321, DestPort: 22, SessionDurationMs: 500, BytesTransferredIn: 512, BytesTransferredOut: 256, Protocol: 'SSH-2.0-OpenSSH_8.8', ClientVersion: 'SSH-2.0-OpenSSH_8.8', KexAlgorithm: 'curve25519-sha256', Cipher: 'aes256-gcm@openssh.com', MAC: 'hmac-sha2-512-etm@openssh.com', SystemLoad: 0.75 } ... [Simulated Detail Repeated For Length] DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} DisconnectInfo{code=11, msg='Bye Bye', phase=preauth} END_CONTEXT", 1.0),
    ("Invalid user deploybot from 10.0.10.5 port 49152. ... CONTEXT: { AttemptedUser: 'deploybot', SourceIP: '10.0.10.5', SourcePort: 49152, DestPort: 22, Protocol: 'SSH-2.0-OpenSSH_8.2p1', ClientVersion: 'SSH-2.0-Go', Status: 'InvalidUser', PamService: 'sshd', PamUser: 'deploybot', PamRhost: '10.0.10.5', PamStatus: 'User not known', PamModule: 'pam_unix.so', Fail2BanStatus: { Filter: 'sshd', Jail: 'sshd', Attempts: 1, MaxAttempts: 5 }, SystemLoad: 0.3, ActiveSessions: 2, FirewallRuleHit: 'None', GeoIP: { Country: 'Internal', City: 'Datacenter A', ISP: 'Private Network' } } ... [Simulated Detail Repeated For Length] InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} InvalidUserAttempt{user='deploybot', ip='10.0.10.5'} END_CONTEXT", 1.0),
    ("Accepted password for charlie from 203.0.113.25 port 61337 ssh2. ... CONTEXT: { User: 'charlie', SourceIP: '203.0.113.25', SourcePort: 61337, AuthMethod: 'password', SessionID: 'session-ghi-789', TTY: 'pts/2', Protocol: 'SSH-2.0-OpenSSH_8.9p1', ClientVersion: 'SSH-2.0-Paramiko_2.9', KexAlgorithm: 'ecdh-sha2-nistp521', Cipher: 'aes256-ctr', MAC: 'hmac-sha2-512', PamService: 'sshd', PamUser: 'charlie', PamStatus: 'Success', LoginTime: 1678896668, UserGroups: ['charlie', 'ops'], HomeDirectory: '/home/charlie', Shell: '/bin/bash', SystemLoad: 1.1, ActiveUserSessions: 13 } ... [Simulated Detail Repeated For Length] LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} LoginSuccess{user='charlie', ip='203.0.113.25', method='password'} END_CONTEXT", 1.0),
    ("subsystem request for sftp by user alice. ... CONTEXT: { User: 'alice', SourceIP: '192.168.10.100', SourcePort: 54321, RequestedSubsystem: 'sftp', SubsystemPath: '/usr/lib/openssh/sftp-server', SessionID: 'session-abc-123', TTY: 'ssh', Protocol: 'SSH-2.0-OpenSSH_8.8', ClientVersion: 'SSH-2.0-OpenSSH_8.8', Status: 'StartingSubsystem', PamService: 'sshd', PamUser: 'alice', LoginTime: 1678896663, CurrentTime: 1678896669, SystemLoad: 1.0 } ... [Simulated Detail Repeated For Length] SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS} SubsystemStart{user='alice', subsystem='sftp', path='/usr/lib/openssh/sftp-server', status=SUCCESS}  END_CONTEXT", 1.0),
];

const SU_MESSAGES: [&str; 2] = [
    "session opened for user cyrus by (uid=0). ... CONTEXT: { PamService: 'su', PamUser: 'cyrus', PamRuser: 'root', PamTTY: '/dev/pts/3', PamModule: 'pam_unix(su:session)', PamStatus: 'Success', TargetUser: { UID: 1001, GID: 1001, Groups: ['cyrus', 'users', 'dev'], Home: '/home/cyrus', Shell: '/bin/bash' }, InvokingUser: { UID: 0, User: 'root', GID: 0, Groups: ['root'], Home: '/root', Shell: '/bin/bash' }, EnvironmentSet: { PATH: '/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', HOME: '/home/cyrus', LOGNAME: 'cyrus', USER: 'cyrus', SHELL: '/bin/bash', TERM: 'xterm-256color' }, ResourceLimits: { CPU: 'unlimited', Memory: 'unlimited', Files: 1024, Processes: 4096 }, SecurityContext: { SELinux: 'unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023', AppArmor: 'unconfined' }, SystemLoad: { Avg1m: 0.1, Avg5m: 0.2, Avg15m: 0.25 }, SessionID: 'su-session-1122' } ... [Simulated Detail Repeated For Length] PamDebug{module='pam_env.so', result='Success', action='setenv', var='HOME=/home/cyrus'} PamDebug{module='pam_limits.so', result='Success', action='apply_limits', resource='nofile', value='1024'} PamDebug{module='pam_unix.so', result='Success', action='open_session', user='cyrus'} PamDebug{module='pam_systemd.so', result='Success', action='register_session', id='su-session-1122'} PamDebug{module='pam_env.so', result='Success', action='setenv', var='HOME=/home/cyrus'} PamDebug{module='pam_limits.so', result='Success', action='apply_limits', resource='nofile', value='1024'} PamDebug{module='pam_unix.so', result='Success', action='open_session', user='cyrus'} PamDebug{module='pam_systemd.so', result='Success', action='register_session', id='su-session-1122'} PamDebug{module='pam_env.so', result='Success', action='setenv', var='HOME=/home/cyrus'} PamDebug{module='pam_limits.so', result='Success', action='apply_limits', resource='nofile', value='1024'} PamDebug{module='pam_unix.so', result='Success', action='open_session', user='cyrus'} PamDebug{module='pam_systemd.so', result='Success', action='register_session', id='su-session-1122'} PamDebug{module='pam_env.so', result='Success', action='setenv', var='HOME=/home/cyrus'} PamDebug{module='pam_limits.so', result='Success', action='apply_limits', resource='nofile', value='1024'} PamDebug{module='pam_unix.so', result='Success', action='open_session', user='cyrus'} PamDebug{module='pam_systemd.so', result='Success', action='register_session', id='su-session-1122'} PamDebug{module='pam_env.so', result='Success', action='setenv', var='HOME=/home/cyrus'} PamDebug{module='pam_limits.so', result='Success', action='apply_limits', resource='nofile', value='1024'} PamDebug{module='pam_unix.so', result='Success', action='open_session', user='cyrus'} PamDebug{module='pam_systemd.so', result='Success', action='register_session', id='su-session-1122'} PamDebug{module='pam_env.so', result='Success', action='setenv', var='HOME=/home/cyrus'} PamDebug{module='pam_limits.so', result='Success', action='apply_limits', resource='nofile', value='1024'} PamDebug{module='pam_unix.so', result='Success', action='open_session', user='cyrus'} PamDebug{module='pam_systemd.so', result='Success', action='register_session', id='su-session-1122'} PamDebug{module='pam_env.so', result='Success', action='setenv', var='HOME=/home/cyrus'} PamDebug{module='pam_limits.so', result='Success', action='apply_limits', resource='nofile', value='1024'} END_CONTEXT",
    "incorrect password for user cyrus from root on /dev/pts/3. ... CONTEXT: { PamService: 'su', PamUser: 'cyrus', PamRuser: 'root', PamTTY: '/dev/pts/3', PamModule: 'pam_unix(su:auth)', PamStatus: 'Authentication failure', AttemptNumber: 2, MaxAttempts: 5, FailDelaySeconds: 3, TargetUser: { UID: 1001, GID: 1001, Home: '/home/cyrus', Shell: '/bin/bash', AccountStatus: 'active', PasswordLastChanged: '2024-10-01' }, InvokingUser: { UID: 0, User: 'root', GID: 0, Home: '/root', Shell: '/bin/bash' }, SecurityContext: { SELinux: 'unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023', AppArmor: 'unconfined' }, SystemLoad: { Avg1m: 0.18, Avg5m: 0.23, Avg15m: 0.25 }, SessionID: 'N/A', Fail2BanStatus: { Filter: 'su-pam', Jail: 'su-pam', Attempts: 2, MaxAttempts: 5, BanTime: 1800, LastAttemptTime: 1678897631 } } ... [Simulated Detail Repeated For Length] PamDebug{module='pam_faildelay.so', result='Success', action='set_delay', delay_ms='3000'} PamDebug{module='pam_unix.so', result='FAIL', action='auth', reason='Incorrect password'} PamDebug{module='pam_warn.so', result='IGNORE', action='auth', message='Authentication failure'} PamDebug{module='pam_deny.so', result='FAIL', action='auth', reason='Authentication failure'} PamDebug{module='pam_faildelay.so', result='Success', action='set_delay', delay_ms='3000'} PamDebug{module='pam_unix.so', result='FAIL', action='auth', reason='Incorrect password'} PamDebug{module='pam_warn.so', result='IGNORE', action='auth', message='Authentication failure'} PamDebug{module='pam_deny.so', result='FAIL', action='auth', reason='Authentication failure'} PamDebug{module='pam_faildelay.so', result='Success', action='set_delay', delay_ms='3000'} PamDebug{module='pam_unix.so', result='FAIL', action='auth', reason='Incorrect password'} PamDebug{module='pam_warn.so', result='IGNORE', action='auth', message='Authentication failure'} PamDebug{module='pam_deny.so', result='FAIL', action='auth', reason='Authentication failure'} PamDebug{module='pam_faildelay.so', result='Success', action='set_delay', delay_ms='3000'} PamDebug{module='pam_unix.so', result='FAIL', action='auth', reason='Incorrect password'} PamDebug{module='pam_warn.so', result='IGNORE', action='auth', message='Authentication failure'} PamDebug{module='pam_deny.so', result='FAIL', action='auth', reason='Authentication failure'} PamDebug{module='pam_faildelay.so', result='Success', action='set_delay', delay_ms='3000'} PamDebug{module='pam_unix.so', result='FAIL', action='auth', reason='Incorrect password'} PamDebug{module='pam_warn.so', result='IGNORE', action='auth', message='Authentication failure'} PamDebug{module='pam_deny.so', result='FAIL', action='auth', reason='Authentication failure'} PamDebug{module='pam_faildelay.so', result='Success', action='set_delay', delay_ms='3000'} PamDebug{module='pam_unix.so', result='FAIL', action='auth', reason='Incorrect password'} PamDebug{module='pam_warn.so', result='IGNORE', action='auth', message='Authentication failure'} PamDebug{module='pam_deny.so', result='FAIL', action='auth', reason='Authentication failure'} PamDebug{module='pam_faildelay.so', result='Success', action='set_delay', delay_ms='3000'} PamDebug{module='pam_unix.so', result='FAIL', action='auth', reason='Incorrect password'} PamDebug{module='pam_warn.so', result='IGNORE', action='auth', message='Authentication failure'} END_CONTEXT",
];

const KLOGIND_MESSAGES: [&str; 3] = [
    "Authentication failed from 163.27.187.39 (163.27.187.39): Permission denied in replay cache code. ... CONTEXT: { ServicePrincipal: 'host/service.example.com@EXAMPLE.COM', ClientPrincipal: 'user@EXAMPLE.COM', ClientAddress: '163.27.187.39', ClientPort: 51234, ServerAddress: '10.0.0.10', ServerPort: 88, ErrorCode: KRB5_KDCREP_MODIFIED (31), FailureReason: 'Replay cache match detected', ReplayCacheType: 'dfl', ReplayCacheName: '/var/tmp/krb5_rc_dfl_12345', DetectedTimestamp: 1678897990111, RequestAuthenticatorTimestamp: 1678897990000, AllowedClockSkewSec: 300, KDCRealm: 'EXAMPLE.COM', TicketFlags: [FORWARDABLE, PROXIABLE, RENEWABLE], EncryptionType: 'aes256-cts-hmac-sha1-96', KeyVersion: 2, AuthenticatorChecksum: 'type=1, checksum=...', SystemLoad: 0.9, ActiveTickets: 5000 } ... [Simulated Detail Repeated For Length] ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} ReplayEntry{client='user@EXAMPLE.COM', server='host/service.example.com@EXAMPLE.COM', ctime=1678897990000, usec=111000} END_CONTEXT",
    "Kerberos authentication failed. ... CONTEXT: { FailureType: 'KRB5_PREAUTH_REQUIRED', ClientPrincipal: 'service_account/host.example.com@OTHER.REALM', ClientAddress: '10.10.50.100', ServerPrincipal: 'krbtgt/EXAMPLE.COM@EXAMPLE.COM', KDCAddress: 'kdc1.example.com:88', ErrorMessage: 'Pre-authentication required: Need to use PA-ENC-TIMESTAMP/PA-ETYPE-INFO2', KrbErrorCode: 25, Realm: 'EXAMPLE.COM', TicketStartTime: null, TicketEndTime: null, AuthTime: null, KeyVersion: null, EncryptionTypeRequested: ['aes256-cts', 'aes128-cts'], SupportedEncryptionTypes: ['aes256-cts-hmac-sha1-96', 'aes128-cts-hmac-sha1-96', 'des3-cbc-sha1'], ClockSkewDetectedSec: null, KdcStatus: { Load: 1.2, ActiveRequests: 150, QueueLength: 5 }, NetworkLatencyMs: 15 } ... [Simulated Detail Repeated For Length] KrbError{code=KDC_ERR_PREAUTH_REQUIRED(25), realm=EXAMPLE.COM, client=service_account/host.example.com@OTHER.REALM, server=krbtgt/EXAMPLE.COM@EXAMPLE.COM, error_text='Pre-authentication information was not present'} KrbError{code=KDC_ERR_PREAUTH_REQUIRED(25), realm=EXAMPLE.COM, client=service_account/host.example.com@OTHER.REALM, server=krbtgt/EXAMPLE.COM@EXAMPLE.COM, error_text='Pre-authentication information was not present'} KrbError{code=KDC_ERR_PREAUTH_REQUIRED(25), realm=EXAMPLE.COM, client=service_account/host.example.com@OTHER.REALM, server=krbtgt/EXAMPLE.COM@EXAMPLE.COM, error_text='Pre-authentication information was not present'} KrbError{code=KDC_ERR_PREAUTH_REQUIRED(25), realm=EXAMPLE.COM, client=service_account/host.example.com@OTHER.REALM, server=krbtgt/EXAMPLE.COM@EXAMPLE.COM, error_text='Pre-authentication information was not present'} KrbError{code=KDC_ERR_PREAUTH_REQUIRED(25), realm=EXAMPLE.COM, client=service_account/host.example.com@OTHER.REALM, server=krbtgt/EXAMPLE.COM@EXAMPLE.COM, error_text='Pre-authentication information was not present'} KrbError{code=KDC_ERR_PREAUTH_REQUIRED(25), realm=EXAMPLE.COM, client=service_account/host.example.com@OTHER.REALM, server=krbtgt/EXAMPLE.COM@EXAMPLE.COM, error_text='Pre-authentication information was not present'} KrbError{code=KDC_ERR_PREAUTH_REQUIRED(25), realm=EXAMPLE.COM, client=service_account/host.example.com@OTHER.REALM, server=krbtgt/EXAMPLE.COM@EXAMPLE.COM, error_text='Pre-authentication information was not present'} KrbError{code=KDC_ERR_PREAUTH_REQUIRED(25), realm=EXAMPLE.COM, client=service_account/host.example.com@OTHER.REALM, server=krbtgt/EXAMPLE.COM@EXAMPLE.COM, error_text='Pre-authentication information was not present'} KrbError{code=KDC_ERR_PREAUTH_REQUIRED(25), realm=EXAMPLE.COM, client=service_account/host.example.com@OTHER.REALM, server=krbtgt/EXAMPLE.COM@EXAMPLE.COM, error_text='Pre-authentication information was not present'} KrbError{code=KDC_ERR_PREAUTH_REQUIRED(25), realm=EXAMPLE.COM, client=service_account/host.example.com@OTHER.REALM, server=krbtgt/EXAMPLE.COM@EXAMPLE.COM, error_text='Pre-authentication information was not present'} KrbError{code=KDC_ERR_PREAUTH_REQUIRED(25), realm=EXAMPLE.COM, client=service_account/host.example.com@OTHER.REALM, server=krbtgt/EXAMPLE.COM@EXAMPLE.COM, error_text='Pre-authentication information was not present'} KrbError{code=KDC_ERR_PREAUTH_REQUIRED(25), realm=EXAMPLE.COM, client=service_account/host.example.com@OTHER.REALM, server=krbtgt/EXAMPLE.COM@EXAMPLE.COM, error_text='Pre-authentication information was not present'} END_CONTEXT",
    "Authentication failed from 163.27.187.39 (163.27.187.39): Software caused connection abort. ... CONTEXT: { ServicePrincipal: 'nfs/storage.example.com@EXAMPLE.COM', ClientPrincipal: 'backup_user@EXAMPLE.COM', ClientAddress: '163.27.187.39', ClientPort: 62345, ServerAddress: '10.0.0.11', ServerPort: 88, ErrorCode: ECONNABORTED (103), FailureReason: 'Client closed connection during KDC processing', KDCRealm: 'EXAMPLE.COM', Stage: 'AS-REQ Processing', RequestSize: 1024 bytes, TimeInQueueMs: 5, ProcessingTimeMs: 50, SystemLoad: 1.5, ActiveRequests: 180, KdcStatus: { Load: 1.5, ActiveRequests: 180, QueueLength: 15 }, NetworkErrorSource: 'TCP Stack', SocketState: 'CLOSE_WAIT', BytesReceived: 1024, BytesSent: 0 } ... [Simulated Detail Repeated For Length] SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} SocketState{fd=15, state=CLOSE_WAIT, peer=163.27.187.39:62345, local=10.0.0.11:88, recv-q=0, send-q=0} END_CONTEXT",
];

const LOGROTATE_MESSAGE: &str = "ALERT exited abnormally with [1]. ... CONTEXT: { ConfigFileProcessed: '/etc/logrotate.d/nginx', LogFileTarget: '/var/log/nginx/access.log', RotationSettings: { Interval: 'daily', MaxSize: '100M', RotateCount: 14, Compress: true, DelayCompress: true, MissingOk: true, NotIfEmpty: true, CreateMode: '0640', CreateUser: 'www-data', CreateGroup: 'adm', PostRotateScript: '/usr/sbin/nginx -s reload', PreRotateScript: null }, ErrorDetails: 'Failed to execute postrotate script \'/usr/sbin/nginx -s reload\'. Exit code: 1. Stderr: nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)', DiskStatus: { Path: '/var/log', UsedPercent: 85, AvailableBytes: 15032385536 }, PermissionsCheck: { ConfigDir: 'OK', LogDir: 'OK', LogFile: 'OK' }, LastSuccessfulRotation: '2025-03-31T03:45:00Z', CronJobID: 'cron-daily-logrotate-12345', SystemLoad: { Avg1m: 1.8, Avg5m: 1.5, Avg15m: 1.2 }, MemoryUsage: { UsedMB: 5120, TotalMB: 8192 } } ... [Simulated Detail Repeated For Length] LogRotateState{file='/var/log/nginx/access.log', status=ERROR, last_rotated='2025-03-31', next_rotation='2025-04-01'} LogRotateState{file='/var/log/nginx/error.log', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} LogRotateState{file='/var/log/syslog', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} LogRotateState{file='/var/log/auth.log', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} LogRotateState{file='/var/log/kern.log', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} LogRotateState{file='/var/log/dpkg.log', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} LogRotateState{file='/var/log/nginx/access.log', status=ERROR, last_rotated='2025-03-31', next_rotation='2025-04-01'} LogRotateState{file='/var/log/nginx/error.log', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} LogRotateState{file='/var/log/syslog', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} LogRotateState{file='/var/log/auth.log', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} LogRotateState{file='/var/log/kern.log', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} LogRotateState{file='/var/log/dpkg.log', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} LogRotateState{file='/var/log/nginx/access.log', status=ERROR, last_rotated='2025-03-31', next_rotation='2025-04-01'} LogRotateState{file='/var/log/nginx/error.log', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} LogRotateState{file='/var/log/syslog', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} LogRotateState{file='/var/log/auth.log', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} LogRotateState{file='/var/log/kern.log', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} LogRotateState{file='/var/log/dpkg.log', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} LogRotateState{file='/var/log/nginx/access.log', status=ERROR, last_rotated='2025-03-31', next_rotation='2025-04-01'} LogRotateState{file='/var/log/nginx/error.log', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} LogRotateState{file='/var/log/syslog', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} LogRotateState{file='/var/log/auth.log', status=OK, last_rotated='2025-04-01', next_rotation='2025-04-02'} END_CONTEXT";

const CUPS_MESSAGES: &str = "cupsd shutdown succeeded. ... CONTEXT: { SignalReceived: 'SIGTERM', Initiator: 'systemd', UptimeSeconds: 86400, ActiveJobs: 0, CompletedJobsToday: 153, CancelledJobsToday: 5, PrintersConfigured: 3, PrintersActive: 2, StateSavedTo: '/var/cache/cups/cupsd.state', LoadedBackends: ['usb', 'snmp', 'dnssd', 'ipp'], LoadedFilters: ['application/pdf -> pdftops (application/postscript)', 'image/jpeg -> imagetops (application/postscript)', ... (30 more)], LoadedDrivers: ['drv:///sample.drv/deskjet.ppd', 'drv:///sample.drv/laserjet.ppd'], FinalResourceUsage: { CPUTimeUserMs: 5000, CPUTimeSystemMs: 2000, MemoryPeakKB: 128000, OpenFiles: 5 }, ShutdownDurationMs: 500, ConfigurationFile: '/etc/cups/cupsd.conf', LogLevel: 'info' } ... [Simulated Detail Repeated For Length] PrinterState{name='Office-LaserJet', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Warehouse-Zebra', state=STOPPED, jobs=0, status='Maintenance required'} PrinterState{name='Marketing-Color', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Office-LaserJet', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Warehouse-Zebra', state=STOPPED, jobs=0, status='Maintenance required'} PrinterState{name='Marketing-Color', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Office-LaserJet', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Warehouse-Zebra', state=STOPPED, jobs=0, status='Maintenance required'} PrinterState{name='Marketing-Color', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Office-LaserJet', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Warehouse-Zebra', state=STOPPED, jobs=0, status='Maintenance required'} PrinterState{name='Marketing-Color', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Office-LaserJet', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Warehouse-Zebra', state=STOPPED, jobs=0, status='Maintenance required'} PrinterState{name='Marketing-Color', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Office-LaserJet', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Warehouse-Zebra', state=STOPPED, jobs=0, status='Maintenance required'} PrinterState{name='Marketing-Color', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Office-LaserJet', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Warehouse-Zebra', state=STOPPED, jobs=0, status='Maintenance required'} PrinterState{name='Marketing-Color', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Office-LaserJet', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Warehouse-Zebra', state=STOPPED, jobs=0, status='Maintenance required'} PrinterState{name='Marketing-Color', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Office-LaserJet', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Warehouse-Zebra', state=STOPPED, jobs=0, status='Maintenance required'} PrinterState{name='Marketing-Color', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Office-LaserJet', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Warehouse-Zebra', state=STOPPED, jobs=0, status='Maintenance required'} PrinterState{name='Marketing-Color', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Office-LaserJet', state=IDLE, jobs=0, status='Ready'} PrinterState{name='Warehouse-Zebra', state=STOPPED, jobs=0, status='Maintenance required'} PrinterState{name='Marketing-Color', state=IDLE, jobs=0, status='Ready'} END_CONTEXT";

lazy_static! {
    static ref SU_MESSAGES_DIST: Uniform<usize> = Uniform::new(0, SU_MESSAGES.len());
    static ref KLOGIND_MESSAGES_DIST: Uniform<usize> = Uniform::new(0, KLOGIND_MESSAGES.len());
    static ref PRIORITY_DIST: Uniform<usize> = Uniform::new(0, 191);
    static ref PID_DIST: Uniform<usize> = Uniform::new(1, 10_000);
    static ref VERSION_DIST: Uniform<usize> = Uniform::new(1, 4);
}

fn priority() -> usize {
    PRIORITY_DIST.sample(&mut thread_rng())
}

fn pid() -> usize {
    PID_DIST.sample(&mut thread_rng())
}

fn syslog_version() -> usize {
    VERSION_DIST.sample(&mut thread_rng())
}

fn timestamp_syslog_3164() -> DelayedFormat<StrftimeItems<'static>> {
    Local::now().format(SYSLOG_3164_FORMAT)
}

fn timestamp_syslog_5424() -> String {
    Local::now().to_rfc3339_opts(SecondsFormat::Millis, true)
}

fn domain() -> String {
    thread_rng().gen::<Domain>().to_string()
}

fn username() -> String {
    thread_rng().gen::<Username>().to_string()
}

fn error_message(application: &str) -> &'static str {
    match application {
        "logrotate" => LOGROTATE_MESSAGE,
        "cups" => CUPS_MESSAGES,
        "su" => choose(&SU_MESSAGES),
        "klogind" => choose(&KLOGIND_MESSAGES),
        "sshd" => choose_weighted(&SSHD_MESSAGES),
        _ => "error",
    }
}

pub fn syslog_3164_log_line() -> String {
    let app = choose_weighted(&APPLICATION_NAMES);
    format!(
        "<{}>{} {} {}[{}]: {}",
        priority(),
        timestamp_syslog_3164(),
        domain(),
        app,
        pid(),
        error_message(app)
    )
}

pub fn syslog_5424_log_line() -> String {
    // Example log line:
    // <65>2 2020-11-05T18:11:43.975Z chiefubiquitous.io totam 6899 ID44 - Something bad happened
    let app = choose_weighted(&APPLICATION_NAMES);
    format!(
        "<{}>{} {} {} {} {} ID{} - {}",
        priority(),
        syslog_version(),
        timestamp_syslog_5424(),
        domain(),
        username(),
        thread_rng().gen_range(100..9999),
        thread_rng().gen_range(1..999),
        error_message(app)
    )
}
